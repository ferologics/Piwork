#!/usr/bin/env bash
#MISE description="Set working folder for active task (one-time bind)"
set -euo pipefail

FOLDER="${1:-$HOME/dev/pui/tmp/test-workdir}"

if ! nc -z localhost 19385 2>/dev/null; then
    echo "Test server not running. Run: mise run test-start"
    exit 1
fi

echo "Requesting working folder: $FOLDER"
echo "{\"cmd\":\"set_folder\",\"folder\":\"$FOLDER\"}" | nc -w 2 localhost 19385

echo "Done."
echo "- If the active task has no folder yet, this sets the first (and only) bind."
echo "- If the active task already has a folder, the UI rejects changes (create a new task)."
