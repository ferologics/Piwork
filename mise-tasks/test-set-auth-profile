#!/usr/bin/env bash
#MISE description="Set active auth profile in UI and restart runtime (test harness)"
set -euo pipefail

PROFILE="${1:-default}"

if ! nc -z localhost 19385 2>/dev/null; then
    echo "Test server not running. Run: mise run test-start"
    exit 1
fi

python - "$PROFILE" <<'PY' | nc -w 2 localhost 19385
import json
import sys

payload = {
    "cmd": "set_auth_profile",
    "profile": sys.argv[1],
}
print(json.dumps(payload))
PY
