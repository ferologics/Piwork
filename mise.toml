[tasks.build]
description = "Build the frontend"
run = "pnpm exec vite build"

[tasks.check]
description = "Fast local gate (format + lint + compile + fast tests)"
run = "mise run format && mise run lint && mise run compile && mise run test"

[tasks.check-full]
description = "Full gate (check + live runtime regressions)"
run = "mise run check && mise run test-regressions"

[tasks.clean]
description = "Remove build artifacts"
run = "rm -rf .svelte-kit build dist package coverage src-tauri/target target node_modules/.vite"

[tasks.clean-deep]
description = "Remove build artifacts + node_modules"
run = "mise run clean && rm -rf node_modules"

[tasks.compile]
description = "Typecheck (svelte-check + cargo check)"
run = "pnpm exec svelte-kit sync && pnpm exec svelte-check --tsconfig ./tsconfig.json && cargo check --manifest-path src-tauri/Cargo.toml"

[tasks.dev]
description = "Run Vite dev server"
run = "pnpm exec vite dev"

[tasks.format]
description = "Format code (Biome + dprint + rustfmt)"
run = "pnpm exec biome format --write src src-tauri/tauri.conf.json src-tauri/capabilities/default.json package.json components.json svelte.config.js vite.config.js tailwind.config.ts tsconfig.json biome.json dprint.json && pnpm exec dprint fmt && cargo fmt --manifest-path src-tauri/Cargo.toml"

[tasks.icons]
description = "Regenerate app icons from assets/logo.svg"
run = "pnpm exec tauri icon assets/logo.svg --output src-tauri/icons"

[tasks.install-git-hooks]
description = "Install repo git hooks (pre-commit + pre-push)"
run = "./scripts/git-hooks/install.sh"

[tasks.lint]
description = "Lint code (oxlint + clippy)"
run = "pnpm exec oxlint --tsconfig tsconfig.json src && cargo clippy --manifest-path src-tauri/Cargo.toml -- -D warnings"

[tasks.preview]
description = "Preview the build"
run = "pnpm exec vite preview"

[tasks.reset]
description = "Deep clean + setup"
run = "mise run clean-deep && mise run setup"

[tasks.runtime-clean]
description = "Remove runtime artifacts"
run = "rm -rf tmp/boot tmp/runtime-* tmp/initramfs-* tmp/apk-cache \"$HOME/Library/Application Support/com.pi.work/runtime\""

[tasks.setup]
description = "Install dependencies and git hooks"
run = "pnpm install && mise run install-git-hooks"

[tasks.tauri-build]
description = "Build the Tauri app"
run = "pnpm exec tauri build"

[tasks.tauri-dev]
description = "Run the Tauri app"
depends = ["runtime-build"]
run = "pnpm exec tauri dev"

[tasks.test]
description = "Run fast tests"
run = "mise run test-vite && mise run test-rust"

[tasks.test-regressions]
description = "Run runtime regression integration tests"
run = "pnpm exec svelte-kit sync && mise run runtime-build && pnpm exec vitest run --minWorkers=1 --maxWorkers=1 src/lib/__tests__/integration/runtime-steady-state.integration.test.ts src/lib/__tests__/integration/journey-sequential.integration.test.ts"

[tasks.test-regressions-if-needed]
description = "Run runtime regressions only when integration-impacting files changed"
run = "./scripts/testing/run-regressions-if-needed.sh"

[tasks.test-rust]
description = "Run Rust tests"
run = "cargo test --manifest-path src-tauri/Cargo.toml"

[tasks.test-vite]
description = "Run fast frontend tests (exclude live integration suite)"
run = "pnpm exec vitest run --exclude src/lib/__tests__/integration/**/*.integration.test.ts"
